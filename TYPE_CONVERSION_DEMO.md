# 自動型態轉換功能說明

## 概述

ExcelAI 節點現在支援自動型態轉換功能。當您在節點介面的欄位中輸入值時，系統會自動將字串值轉換為適當的型態。

## 支援的型態轉換

### 1. 數字 (Number)
字串形式的數字會自動轉換為數值型態。

**範例：**
- `"123"` → `123` (整數)
- `"45.67"` → `45.67` (浮點數)
- `"-99"` → `-99` (負整數)
- `"-123.45"` → `-123.45` (負浮點數)
- `"0.123"` → `0.123` (小於1的浮點數)

### 2. 布林值 (Boolean)
字串形式的布林值會自動轉換，且不區分大小寫。

**範例：**
- `"true"` → `true`
- `"false"` → `false`
- `"TRUE"` → `true`
- `"False"` → `false`

### 3. 空值 (Null)
以下值會被轉換為 `null`：

**範例：**
- `"null"` → `null`
- `""` (空字串) → `null`
- `"   "` (僅有空白) → `null`

### 4. 日期 (Date)
ISO 8601 格式的日期字串會自動轉換為 Date 物件。

**範例：**
- `"2024-01-15"` → `Date 物件`
- `"2024-01-15T10:30:00Z"` → `Date 物件`
- `"2024-01-15T10:30:00.123Z"` → `Date 物件`
- `"2024-01-15T10:30:00+08:00"` → `Date 物件`

### 5. 保持原樣的值
如果值不符合以上任何格式，會保持原始字串。

**範例：**
- `"N/A"` → `"N/A"` (保持字串)
- `"$100"` → `"$100"` (保持字串，因為包含貨幣符號)
- `"hello world"` → `"hello world"` (保持字串)
- `"maybe"` → `"maybe"` (保持字串)
- `"yesterday"` → `"yesterday"` (保持字串，非標準日期格式)

### 6. 已經是正確型態的值
如果傳入的值已經是目標型態，會直接使用而不進行轉換。

**範例：**
- `123` (數字) → `123` (保持數字)
- `true` (布林) → `true` (保持布林)
- `new Date()` → `Date 物件` (保持 Date)
- `null` → `null` (保持 null)

## 使用場景

### 場景 1: 新增列 (Append Row)

```json
{
  "Name": "John Doe",
  "Age": "30",              // 字串 → 30 (數字)
  "Active": "true",         // 字串 → true (布林)
  "CreatedAt": "2024-01-15T10:30:00Z",  // 字串 → Date 物件
  "Balance": "1234.56",     // 字串 → 1234.56 (數字)
  "Notes": "null"           // 字串 → null
}
```

### 場景 2: 更新列 (Update Row)

```json
{
  "Active": "FALSE",        // 字串 → false (不區分大小寫)
  "Age": "35",              // 字串 → 35 (數字)
  "Balance": "-99.99"       // 字串 → -99.99 (負數)
}
```

### 場景 3: 插入列 (Insert Row)

```json
{
  "Name": "Jane Smith",
  "Age": "",                // 空字串 → null
  "Active": "false",        // 字串 → false
  "CreatedAt": "null",      // 字串 → null
  "Balance": "0",           // 字串 → 0 (數字零)
  "Notes": "   "            // 僅空白 → null
}
```

## 技術實現

型態轉換在以下兩個方法中執行：
1. `mapRowData()` - 用於 appendRow 和 insertRow 操作
2. `handleUpdateRow()` - 用於 updateRow 操作

核心轉換邏輯在 `convertValue()` 私有方法中實現，該方法會：
1. 檢查值是否為 null 或 undefined
2. 檢查值是否已經是非字串型態（若是則直接返回）
3. 嘗試按順序轉換為：
   - 空值 (null)
   - 布林值 (boolean)
   - 數字 (number)
   - 日期 (Date)
4. 如果都不匹配，保持原始字串

## 測試覆蓋

已新增 7 個專門的測試案例來驗證型態轉換功能：
1. ✅ 字串數字轉數值
2. ✅ 布林字串轉布林值
3. ✅ 空值與空字串處理
4. ✅ ISO 日期字串轉 Date 物件
5. ✅ 保持非字串值不變
6. ✅ 保持普通字串不轉換
7. ✅ 負數與小數處理

所有測試都已通過 ✓

## 效益

1. **使用者友善**：使用者可以直接在節點介面輸入字串，無需手動轉換型態
2. **與 AI Agent 整合**：AI Agent 可以直接傳遞字串值，系統會自動處理型態
3. **資料一致性**：確保 Excel 檔案中的資料型態正確
4. **減少錯誤**：自動處理常見的型態轉換，減少手動錯誤
